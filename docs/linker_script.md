# Linker Script

The linker script is a file that guides the linker (the tool that combines the object code generated by the compiler into a single executable) on how to organize the memory sections in the final file, which is usually an .elf file. For embedded systems, this is critical as specific hardware memory constraints must be met.

## Entry command

- This command is used to set the "Entry point address" information in the header of final .elf file generated.
- In our case, "Reset_Handler" is the entry point into the application. The first piece of code that executes right after the processor reset.
- The debugger uses this information to locate the first function to execute.
- Not a mandatory command to use, but required when you debug the .elf using the debugger (GDB).
- Syntax: Entry(_symbol_name_)

        Entry(Reset_Handler)

## Memory command

- This command allows you to describe the different memories present in the target and their start address and size information.
- The linker uses information mentioned in this command to assign address to merged sections.
- The information is given under this command also helps the linker to calculate total code and data memory consumed so far and throw an error message if data, code, heap or stack areas cannot fit into available size.
- By using memory command, you can fine-tune various memories available in your target and allow different sections to occupy different memory areas.
- Typically one linker script has one memory command.

Syntax:

    MEMORY
    {
        name(attr) : ORIGIN = origin, LENGTH = len
    }

    attr letter     |       Meaning
    ----------------|----------------------------------------------------------   
        R           |       Read-only sections
        W           |       Read and write sections
        X           |       Sections containing executable code
        A           |       Allocated sections
        I           |       Initialized sections
        L           |       Same as 'I'
        !           |       Invert the sense of any of the following attributes

## Sections command

- Sections commnad is used to create different output sections in the final .elf executable.
- Important command by which you can instruct the linker how to merge the input sections to yield an output section.
- This commnad also controls the order in which different output sections appear in the .elf file generated.
- By using this commnand, you also mention the placement of a section in memory region. For example, you instruct the linker to place the .text section in the FLASH memory region, which is described by the MEMORY command.

### VMA and LMA

- VMA (Virtual Memory Address): The address where a section is expected to be during execution.
- LMA (Load Memory Address): The address where a section is initially stored in memory before being copied or relocated to its VMA.

## Location Counter

- This is a special linker symbol denoted by a dot '.'
- This symbol is called "location counter" since linker automatically updates this symbol with location (address) information.
- You can use this symbol inside the linker script to track and define boundaries of various sections.
- You can also set location counter to any specific value while writing linker script.
- Location counter should appear only inside the **SECTIONS** command.
- The location counter is incremented by the size of the output section.

***Note: Location counter always tracks VMA of the section in which it is being used***

## Linker Script Symbol

- A symbol is the name of an address.
- A symbol declaration is not equivalent to a variable declaration what you do in your 'C' application.

       ––––––––––––––––––––––                       –––––––––––––––––––––––––
      |      main.c          |                     |          main.o         |
      |                      |                     |                         |
      |  int my_value = 100; |                     |      Symbol Table       |
      |  (global variable)   |                     |  (address)   | (symbol) |
      |                      |     ----------->    |              |          |
      |  my_value = 50;      |                     |  0x2000_0000 | my_value |
      |                      |                     |              |          |
      |  void func1(void)    |                     |  0x0800_8000 | func1    |
      |  {...}               |                     |                         |
       ––––––––––––––––––––––                       –––––––––––––––––––––––––
